# Приложение для управления серверными ресурсами

Это веб-приложение предназначено для управления иерархическими списками серверных ресурсов. Оно состоит из бэкенда на Python с FastAPI и PouchDB, а также фронтенда на React с TypeScript.

## Структура проекта

```
server-manager/
├── backend/                # Бэкенд на Python с FastAPI
│   ├── data/               # Директория для данных PouchDB
│   ├── pouchdb-server/     # Node.js сервер для PouchDB
│   ├── venv/               # Виртуальное окружение Python
│   ├── .env                # Переменные окружения для бэкенда
│   ├── activate.sh         # Скрипт активации виртуального окружения
│   ├── init_db.py          # Скрипт инициализации базы данных
│   ├── init_db.sh          # Скрипт запуска инициализации базы данных
│   ├── main.py             # Основной файл бэкенда
│   ├── requirements.txt    # Зависимости Python
│   └── run.sh              # Скрипт запуска бэкенда
├── frontend/               # Фронтенд на React с TypeScript
│   ├── public/             # Статические файлы
│   ├── src/                # Исходный код фронтенда
│   ├── .env                # Переменные окружения для фронтенда
│   ├── fix_dependencies.sh # Скрипт исправления зависимостей
│   └── package.json        # Зависимости Node.js
└── run.sh                  # Скрипт запуска всего приложения
```

## Требования

- Python 3.8+
- Node.js 14+
- Виртуальное окружение Python (venv)

## Установка и запуск

### Запуск приложения

Для запуска всего приложения (бэкенд и фронтенд) выполните:

```bash
./run.sh
```

Этот скрипт:
1. Останавливает все запущенные процессы
2. Запускает PouchDB-сервер
3. Запускает бэкенд (FastAPI)
4. Запускает фронтенд (React)

При завершении работы скрипта бэкенд и PouchDB-сервер будут автоматически остановлены.

### Запуск компонентов по отдельности

Для запуска только бэкенда (включая PouchDB-сервер):

```bash
cd backend
./run.sh
```

### Активация виртуального окружения

```bash
cd backend
./activate.sh
```

### Инициализация базы данных тестовыми данными

```bash
cd backend
./init_db.sh
```

Этот скрипт создаст тестовые данные:
- Тестовый пользователь admin
- Две зоны: production и testing
- Окружения и серверы в каждой зоне

## Доступ к приложению

- Фронтенд: http://localhost:3000
- API бэкенда: http://localhost:8000
- Документация API: http://localhost:8000/docs
- PouchDB-сервер: http://localhost:5985

## Аутентификация

Для входа в приложение используйте следующие учетные данные:
- Имя пользователя: admin
- Пароль: admin123

## Архитектура приложения

- **Бэкенд**: Python + FastAPI
- **Фронтенд**: React + TypeScript + Material UI v5
- **База данных**: PouchDB-сервер (встроенная NoSQL база данных)
- **Взаимодействие**: Фронтенд взаимодействует с бэкендом через REST API
- **Аутентификация**: JWT-токены

## Иерархия данных
- **Зона** (Zone): Production, Testing, Development
- **Область** (Environment): Например, main, qa, staging
- **Сервер** (Server): FQDN, IP, статус (доступен или нет), тип сервера

## API Endpoints

### Аутентификация
- `POST /token` - Получение токена доступа

### Зоны
- `GET /zones/` - Получение списка всех зон
- `POST /zones/` - Создание новой зоны
- `GET /zones/{zone_name}` - Получение информации о зоне
- `PUT /zones/{zone_name}` - Обновление зоны
- `DELETE /zones/{zone_name}` - Удаление зоны

### Окружения
- `POST /zones/{zone_name}/environments/` - Добавление окружения в зону
- `PUT /zones/{zone_name}/environments/{env_name}` - Обновление окружения
- `DELETE /zones/{zone_name}/environments/{env_name}` - Удаление окружения

### Серверы
- `POST /zones/{zone_name}/environments/{env_name}/servers/` - Добавление сервера в окружение
- `PUT /zones/{zone_name}/environments/{env_name}/servers/{server_fqdn}` - Обновление сервера
- `DELETE /zones/{zone_name}/environments/{env_name}/servers/{server_fqdn}` - Удаление сервера

## Особенности виртуального окружения

Проект использует виртуальное окружение Python для изоляции зависимостей. Это обеспечивает:
- Изоляцию зависимостей проекта от системных пакетов Python
- Улучшенную переносимость между разными системами
- Предотвращение конфликтов зависимостей между проектами

Скрипты `run.sh` автоматически активируют виртуальное окружение при необходимости. 